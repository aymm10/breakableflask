devsecops.yml
name: Automatisation des tests DevSecOps

on: push

jobs:

  DependenciesScan:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout du code
        uses: actions/checkout@v4

      - name: ğŸ Configuration de Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ğŸ› ï¸ Installation de Safety
        run: pip install safety

      - name: ğŸ” ContrÃ´le des dÃ©pendances (requirements.txt)
        # ExÃ©cute l'analyse et affiche le rapport
        run: safety check -r requirements.txt --full-report
        # Cette ligne permet au pipeline de continuer mÃªme si Safety trouve des vulnÃ©rabilitÃ©s (exit code non-nul)
        continue-on-error: true 

  ---
  
  ContainerScan:
    runs-on: ubuntu-latest
    needs: DependenciesScan
    steps:
      - name: â¬‡ï¸ Checkout du code
        uses: actions/checkout@v4

      - name: ğŸ”¨ Construction de l'image Docker
        run: docker build -t monapp:latest . 

      - name: âš™ï¸ Installation de Trivy
        uses: aquasecurity/trivy-action@master
        with:
          install-only: true

      - name: ğŸ” Scan de l'image Docker avec Trivy
        # Retire l'option --exit-code 1 et utilise la sÃ©vÃ©ritÃ© pour le rapport uniquement
        run: trivy image --severity CRITICAL,HIGH,MEDIUM monapp:latest
        # Cette ligne permet au pipeline de continuer mÃªme si Trivy trouve des vulnÃ©rabilitÃ©s critiques ou Ã©levÃ©es
        continue-on-error: true 

  ---
  
  Deploy:
    runs-on: ubuntu-latest
    needs: ContainerScan
    steps:
      - name: Deploy
        run: |
          echo "Rien Ã  faire ici. Votre application est prÃªte Ã  Ãªtre dÃ©ployÃ©e"
